<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div id="Con">
        <nav class="navTop">
            <div class="navContent">
                <div class="navContentLeft">
                    <p>尚品汇欢迎您</p>
                    <p>请
                        <a href="javascript:void(0)">登录</a>
                        <a href="javascript:void(0)">免费注册</a>
                    </p>
                </div>
                <div class="navContentRight">
                    <a href="javascript:void(0)">我的订单</a>
                    <a href="javascript:void(0)">我的购物车</a>
                    <a href="javascript:void(0)">我的尚品汇</a>
                    <a href="javascript:void(0)">尚品汇会员</a>
                    <a href="javascript:void(0)">企业采购</a>
                    <a href="javascript:void(0)">关注尚品汇</a>
                    <a href="javascript:void(0)">合作招聘</a>
                    <a href="javascript:void(0)">商家后台</a>
                </div>
            </div>
        </nav>
        <div class="banner">
            <h2>
                <a href="">
                    <img src="./images/Logo.png" alt="">
                </a>
            </h2>
            <div class="search">
                <input type="text" name="" id="">
                <button>搜索</button>
            </div>
        </div>
        <div class="navCenterOuter">
            <nav class="navCenter">
                <h2>所有商品分类</h2>
                <nav>
                    <a href="javascript:void(0)">服装城</a>
                    <a href="javascript:void(0)">美妆馆</a>
                    <a href="javascript:void(0)">尚品汇超市</a>
                    <a href="javascript:void(0)">全球购</a>
                    <a href="javascript:void(0)">闪购</a>
                    <a href="javascript:void(0)">团购</a>
                    <a href="javascript:void(0)">有趣</a>
                    <a href="javascript:void(0)">秒杀</a>
                </nav>
            </nav>
        </div>
        <div class="mainProduct">
            <div class="category">
                <a href="javascript:void(0)">手机、数码、通讯手机</a>
                <a href="javascript:void(0)">Apple苹果</a>
                <a>iphone 6S系类</a>
            </div>
            <div class="productInfo">
                <div class="preview">
                    <div class="previewArea">
                        <div class="bigImg">
                            <img src="./images/s1.png" alt="">
                            <div class="mask"></div>
                        </div>
                        <div class="previewBigImg">
                            <img src="./images/b1.png" alt="">
                        </div>
                    </div>
                    <div class="smallImg">
                        <button class="left">&lt;</button>
                        <div class="smallImgOuter">
                            <ul>
                            </ul>
                        </div>
                        <button class="right">&gt;</button>
                    </div>
                </div>
                <div class="detail">
                    <div class="priceArea">

                    </div>
                    <div class="chooseInsert">
                    </div>
                    <div class="buychoose">

                    </div>
                    <div class="addCart">
                        <div class="num">
                            <input type="text" value="1" readonly>
                            <div class="numBtn">
                                <button class="add">+</button>
                                <button class="minus">-</button>
                            </div>
                        </div>
                        <div class="addBtn">
                            加入购物车
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="othersProduct">
            <div class="left">
                <div class="top">
                    <h4 class="active">相关分类</h4>
                    <h4>推荐品牌</h4>
                </div>
                <div class="bottom">
                    <div class="bottomLeft active">
                        <ul class="category">
                            <li><a href="javascript:void(0)">手机</a></li>
                            <li><a href="javascript:void(0)">手机壳</a></li>
                            <li><a href="javascript:void(0)">内存卡</a></li>
                            <li><a href="javascript:void(0)">Iphone配件</a></li>
                            <li><a href="javascript:void(0)">贴膜</a></li>
                            <li><a href="javascript:void(0)">手机耳机</a></li>
                            <li><a href="javascript:void(0)">移动电源</a></li>
                            <li><a href="javascript:void(0)">平板电脑</a></li>
                        </ul>
                        <ul class="goods">
                            <li>
                                <div>
                                    <img src="./images/part01.png" alt="">
                                </div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <button>加入购物车</button>
                            </li>
                            <li>
                                <div>
                                    <img src="./images/part01.png" alt="">
                                </div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <button>加入购物车</button>
                            </li>
                            <li>
                                <div>
                                    <img src="./images/part01.png" alt="">
                                </div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <button>加入购物车</button>
                            </li>
                            <li>
                                <div>
                                    <img src="./images/part01.png" alt="">
                                </div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <button>加入购物车</button>
                            </li>
                        </ul>
                    </div>
                    <div class="bottomRight">
                        推荐品牌
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="selectGoods">
                    <h4>选择搭配</h4>
                    <div class="addOthers">
                        <div class="mainGoods">
                            <img src="./images/l-m01.png" alt="">
                            <p>￥5299</p>
                        </div>
                        <ul class="selectOthers">
                            <li>
                                <img src="./images/dp01.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox">
                                    <span>39</span>
                                </label>
                            </li>
                            <li>
                                <img src="./images/dp02.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox">
                                    <span>50</span>
                                </label>
                            </li>
                            <li>
                                <img src="./images/dp03.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox">
                                    <span>59</span>
                                </label>
                            </li>
                            <li>
                                <img src="./images/dp04.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox">
                                    <span>99</span>
                                </label>
                            </li>
                        </ul>
                        <div class="addSum">
                            <p>已选购0件商品</p>
                            <p>套餐价</p>
                            <p>￥5299</p>
                            <button class="addCart">加入购物车</button>
                        </div>
                    </div>
                </div>
                <div class="goodsDetailInfo">
                    <ul class="detailTab">
                        <li class="active"><a href="javascript:void(0)">商品介绍</a></li>
                        <li><a href="javascript:void(0)">规格与包装</a></li>
                        <li><a href="javascript:void(0)">售后保障</a></li>
                        <li><a href="javascript:void(0)">商品评价</a></li>
                        <li><a href="javascript:void(0)">手机社区</a></li>
                    </ul>
                    <div class="tabContent">
                        <div class="tabOne active">
                            <ul>
                                <li>分辨率：1920*1080(FHD)</li>
                                <li>后置摄像头：1200万像素</li>
                                <li>前置摄像头：500万像素</li>
                                <li>核 数：其他</li>
                                <li>频 率：以官网信息为准</li>
                                <li>品牌： Apple</li>
                                <li>商品名称：APPLEiPhone 6s Plus</li>
                                <li>商品编号：1861098</li>
                                <li>商品产地：中国大陆</li>
                                <li>商品毛重：0.51kg</li>
                                <li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
                                <li>系统：苹果（IOS）</li>
                                <li>像素：1000-1600万品毛重：0.51kg</li>
                                <li>机身内存：64GB</li>
                            </ul>
                            <div>
                                <img src="./images/intro01.png" alt="">
                                <img src="./images/intro02.png" alt="">
                                <img src="./images/intro03.png" alt="">
                            </div>
                        </div>
                        <div>规格与包装</div>
                        <div>售后保障</div>
                        <div>商品评价</div>
                        <div>手机社区</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toolBar">
            <div class="content"></div>
            <div class="menu"></div>
            <ul class="navItem">
                <li><i></i>
                    <p>商品会员</p>
                </li>
                <li><i></i>
                    <p>购物车</p>
                </li>
                <li><i></i>
                    <p>我的足迹</p>
                </li>
                <li><i></i>
                    <p>我的消息</p>
                </li>
                <li><i></i>
                    <p>我的关注</p>
                </li>
            </ul>
            <div class="toTop"></div>
        </div>
    </div>
    <script src="./js/data.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {

            //1.放大镜功能
            magnifier();

            function magnifier() {
                var oPre = document.querySelector(".previewArea");
                var oMask = document.querySelector(".previewArea .bigImg .mask");
                var oBigImg = document.querySelector(".previewArea .bigImg img");
                var oPreBigImgAre = document.querySelector(".previewArea .previewBigImg");
                var oPreBigImg = document.querySelector(".previewArea .previewBigImg img");
                oPre.onmousemove = function (e) {

                    oMask.style.display = "block";
                    oPreBigImgAre.style.display = "block";

                    var oMaskLocation = {
                        left: e.clientX - oBigImg.getBoundingClientRect().left - oMask.offsetWidth / 2,
                        top: e.clientY - oBigImg.getBoundingClientRect().top - oMask.offsetHeight / 2
                    }
                    if (oMaskLocation.left <= 0) {
                        oMaskLocation.left = 0;
                    } else if (oMaskLocation.left >= oBigImg.clientWidth - oMask.offsetWidth) {
                        oMaskLocation.left = oBigImg.offsetWidth - oMask.offsetWidth;
                    }
                    if (oMaskLocation.top <= 0) {
                        oMaskLocation.top = 0;
                    } else if (oMaskLocation.top >= oBigImg.clientWidth - oMask.offsetHeight) {
                        oMaskLocation.top = oBigImg.offsetHeight - oMask.offsetHeight;
                    }

                    //蒙版能移动的总距离/预览图能移动的总距离=蒙版移动距离/预览图移动距离
                    //预览图移动距离=(预览图能移动的总距离*蒙版移动距离)/蒙版能移动的总距离

                    var scale = oPreBigImg.offsetWidth / oPreBigImgAre.clientWidth;
                    var oPreBigImgLocation = {
                        left: -oMaskLocation.left * scale,
                        top: -oMaskLocation.top * scale
                    }

                    oMask.style.left = oMaskLocation.left + "px";
                    oMask.style.top = oMaskLocation.top + "px";
                    oPreBigImg.style.left = oPreBigImgLocation.left + "px";
                    oPreBigImg.style.top = oPreBigImgLocation.top + "px";

                }

                oPre.onmouseleave = function () {
                    oMask.style.display = "none";
                    oPreBigImgAre.style.display = "none";
                }
            }

            //2.动态生成缩略图
            thumbnaiData();

            function thumbnaiData() {
                var oList = document.querySelector(".preview .smallImg .smallImgOuter ul");
                var imgData = goodData.imgsrc;
                var drag = document.createDocumentFragment();
                imgData.forEach(function (item, index) {
                    var oLi = document.createElement("li");
                    var img = new Image();
                    img.src = item.s;
                    oLi.appendChild(img);
                    drag.appendChild(oLi);
                });
                oList.appendChild(drag);
            };

            //3.缩略图
            thumbnai();

            function thumbnai() {
                var oList = document.querySelector(".smallImg .smallImgOuter ul");
                var oLis = document.querySelectorAll(".smallImg .smallImgOuter ul li");
                var oLeft = document.querySelector(".smallImg .left");
                var oRight = document.querySelector(".smallImg .right");
                var oListStartLocation = 0;
                var oListAllMove = (oLis.length - 5) * oLis[0].offsetWidth;
                var oListEveryMove = 2 * oLis[0].offsetWidth;

                oRight.onclick = function () {
                    if (oListAllMove - oListStartLocation < oListEveryMove) {
                        oListStartLocation = oListAllMove;
                    } else {
                        oListStartLocation += oListEveryMove;
                    }

                    oList.style.transform = "translateX(-" + oListStartLocation + "px)";
                }

                oLeft.onclick = function () {
                    if (oListStartLocation < oListEveryMove) {
                        oListStartLocation = 0;
                    } else {
                        oListStartLocation -= oListEveryMove;
                    }

                    oList.style.transform = "translateX(-" + oListStartLocation + "px)";
                }
            }


            //4.缩略图点击
            thumbnaiClick();

            function thumbnaiClick() {
                var oBigImg = document.querySelector(".previewArea .bigImg img");
                var oPreBigImg = document.querySelector(".previewArea .previewBigImg img");
                var oLiImgs = document.querySelectorAll(".smallImg .smallImgOuter ul li img");
                var imgData = goodData.imgsrc;
                oLiImgs.forEach(function (item, index) {
                    item.onclick = function () {
                        oBigImg.src = item.src;
                        oPreBigImg.src = imgData[index].b;
                    }
                });
            }

            //5.详情数据加载
            detailData();

            function detailData() {
                var oPriceAre = document.querySelector(".detail .priceArea");
                var data = goodData.goodsDetail;
                var htmlStr = '<h3 class="title">' + data.title + '</h3>\
                    <p class="adv">' + data.recommend + '</p>\
                    <div class="price">\
                        <p>\
                            <span>价　　格</span>\
                            <span>￥<strong class="allPrice">' + data.price + '</strong></span>\
                        </p>\
                        <p>\
                            <span>促　　销</span> </span>\
                            <span>\<strong class="addprice">' + data.promoteSales.type + '</strong>\
                                ' + data.promoteSales.content + ' </span>\
                        </p>\
                    </div>\
                    <div class="others">\
                        <p>支　　持　' + data.support + '</p>\
                        <p>配 送 至　' + data.address + '</p>\
                    </div>';
                oPriceAre.innerHTML = htmlStr;
            }


            //6.用面向对象的方法实现侧边栏选项卡切换
            function Tab(oTitle, oContent) {
                this.oTitle = oTitle;
                this.oContent = oContent;
                var _this = this;
                this.oTitle.forEach(function (item, index) {
                    item.onclick = function () {
                        _this.click(this, index);
                    }
                });
            }

            Tab.prototype.click = function (t, i) {
                var _this = this;
                this.oTitle.forEach(function (item, index) {
                    item.classList.remove("active");
                    _this.oContent[index].classList.remove("active");
                });
                t.classList.add("active");
                this.oContent[i].classList.add("active");
            }

            leftTab();

            function leftTab() {
                var oTitle = document.querySelectorAll(".othersProduct .left .top h4");
                var oContent = document.querySelectorAll(".othersProduct .left .bottom>div");
                new Tab(oTitle, oContent);
            }

            rightTab();

            function rightTab() {
                var oTitle = document.querySelectorAll(".goodsDetailInfo .detailTab li");
                var oContent = document.querySelectorAll(".goodsDetailInfo .tabContent>div");
                new Tab(oTitle, oContent);
            }

            //7.工具栏点击展开、收缩、返回顶部
            toolBar();

            function toolBar() {
                var oToolBar = document.querySelector(".toolBar");
                var oToolMenu = document.querySelector(".toolBar .menu");
                var oToolTop = document.querySelector(".toolBar .toTop");
                var flag = false;
                oToolMenu.onclick = function () {
                    if (!flag) {
                        oToolBar.style.right = 0;
                    } else {
                        oToolBar.style.right = "-295px";
                    }
                    flag = !flag;
                }

                oToolTop.onclick = function (e) {
                    var startPosition = window.pageYOffset;
                    var endPosition = 0;
                    var startStep = 0;
                    var endStep = 40;
                    var everyStep = (endPosition - startPosition) / endStep;
                    var timer = null;
                    var timer = setInterval(function () {
                        startStep++;
                        if (startStep >= endStep) {
                            clearInterval(timer);
                        }
                        startPosition += everyStep;
                        window.scrollTo(0, startPosition);
                    }, 20);
                }


            }


            //8.动态生成可选择的商品款式列表
            createProductType();

            function createProductType() {
                var oChoose = document.querySelector(".buychoose");
                var data = goodData.goodsDetail.crumbData;
                data.forEach(function (item, index) {
                    var frag = document.createDocumentFragment();
                    var oDl = document.createElement("dl");
                    var oDt = document.createElement("dt");
                    oDt.textContent = item.title;
                    frag.appendChild(oDt);
                    item.data.forEach(function (item, index) {
                        var oDd = document.createElement("dd");
                        oDd.textContent = item.type;
                        oDd.dataset.price = item.changePrice;
                        frag.appendChild(oDd);
                    })
                    oDl.appendChild(frag);
                    oChoose.appendChild(oDl);
                })
            }


            //9.选择商品款式
            chooseProduct();

            function chooseProduct() {
                var chooseArr = new Array(4);
                var oDls = document.querySelectorAll(".buychoose dl");
                var oChooses = document.querySelector(".chooseInsert");
                chooseArr.fill(null);
                oDls.forEach(function (item, index) {
                    var oDlIndex = index;
                    var oDds = item.querySelectorAll("dd");
                    oDds.forEach(function (item, index) {
                        item.onclick = function () {
                            oDds.forEach(function (item, index) {
                                item.style.color = "#666";
                            });
                            this.style.color = "red";
                            chooseArr[oDlIndex] = this;

                            oChooses.textContent = "";
                            chooseArr.forEach(function (item, index) {
                                if (!item) {
                                    return;
                                }
                                var oMark = document.createElement("mark");
                                oMark.textContent = item.textContent;
                                var oA = document.createElement("a");
                                oA.textContent = "X";
                                oA.href = "javascript:void(0);";
                                oA.dataset.index = index;
                                oMark.appendChild(oA);
                                oChooses.appendChild(oMark);
                            });


                            var oAs = document.querySelectorAll("mark a");
                            oAs.forEach(function (item, index) {
                                item.onclick = function () {
                                    this.parentNode.remove();
                                    chooseArr[this.dataset.index] = null;
                                    var oDls = document.querySelectorAll(
                                        ".buychoose dl");
                                    var oClearDds = oDls[this.dataset.index]
                                        .querySelectorAll(".buychoose dl dd");
                                    oClearDds.forEach(function (item, index) {
                                        item.style.color = "#666";
                                    });
                                    oClearDds[0].style.color = "red";
                                    changePrice(chooseArr);
                                }

                            });
                            changePrice(chooseArr);
                        }
                    });
                });

                function changePrice(arr) {
                    var startPrice = goodData.goodsDetail.price;
                    var endPrice = document.querySelector(".priceArea .price p strong");
                    var chooseNum = document.querySelector(".addCart .num input");
                    arr.forEach(function (item, index) {
                        if (!item) {
                            return;
                        }
                        startPrice += +item.dataset.price;
                    });
                    endPrice.textContent = chooseNum.value * startPrice;
                }
            }

            modifyNum();
            //10.修改购买数量
            function modifyNum() {
                var oAdd = document.querySelector(".addCart .numBtn .add");
                var oMinus = document.querySelector(".addCart .numBtn .minus");
                var oBuyNum = document.querySelector(".addCart .num input");
                var oPrice = document.querySelector(".priceArea .price p strong");
                var sum = 1;
                oAdd.onclick = function () {
                    var onePrice = +oPrice.textContent / sum;
                    sum++;
                    oBuyNum.value = sum;
                    oPrice.textContent = onePrice * sum;
                }
                oMinus.onclick = function () {
                    var onePrice = +oPrice.textContent / sum;
                    sum--;
                    if (sum < 1) {
                        sum = 1;
                        return;
                    }
                    oBuyNum.value = sum;
                    oPrice.textContent = onePrice * sum;
                }
            }


        });
    </script>
</body>

</html>